<main class="weekly-main">
  <div class="page-header">
    <h2 class="page-title">Live Weekly Table</h2>
    <button id="toggle-button" class="toggle-btn" onclick="toggleTables()">
      <span class="loading-text">Loading data from LiveFPL ...</span>
    </button>
  </div>
  
  <div class="table-container">
    <div class="table-controls">
      <button id="left-arrow" class="nav-arrow nav-arrow-left" onclick="shiftLeft()" aria-label="Previous weeks">
        <span class="arrow-icon">←</span>
        <span class="arrow-text">Prev</span>
      </button>
      
      <div class="table-wrapper">
        <table id="data-table" class="weekly-table">
          <thead id="table-header"></thead>
          <tbody id="data-body"></tbody>
        </table>
      </div>
      
      <button id="right-arrow" class="nav-arrow nav-arrow-right" onclick="shiftRight()" aria-label="Next weeks">
        <span class="arrow-text">Next</span>
        <span class="arrow-icon">→</span>
      </button>
    </div>
  </div>
</main>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="{{ url_for('static', filename='fe_script.js') }}"></script>
<script>
  const leagueId = '{{ league_id }}'; // Replace with actual league ID
  const apiUrl = `/api/week/${leagueId}`;

  // Fetch data from the API
  fetch(apiUrl)
    .then(response => response.json())
    .then(responseData => {
      // Handle both old format (direct data array) and new format (object with data + current_week)
      if (Array.isArray(responseData)) {
        // Old format - backward compatibility
        initializeDataTable(responseData, leagueId);
      } else {
        // New format with current week info
        initializeDataTable(responseData.data, leagueId, false, responseData.current_week);
      }
    })
    .catch(error => {
      console.error('Error fetching data:', error);
      document.getElementById('toggle-button').textContent = 'Error loading data.';
    });

  // Function to toggle visibility of the tables
  function toggleTables() {
    const table = document.getElementById('data-table');
    const button = document.getElementById('toggle-button');

    // Toggle display styles based on current state
    if (table.style.display === 'none') {
      table.style.display = 'table'; // Show main table
      button.textContent = 'Hide Table'; // Update button text
    } else {
      table.style.display = 'none'; // Hide main table
      button.textContent = 'Show Table'; // Update button text
    }
  }
</script>